---
template: main.html
codeblocks:
    - match: brew install iter8
      validate: brew info iter8
    - match: docker run .* httpbin
      validate: docker ps | grep httpbin
    - match: docker kill httpbin
      validate: docker ps | grep httpbin && exit 1 || exit 0
imports:
    - docker/install
    - ../../getting-started/install.md
---

# Benchmark and Validate HTTP services

The `load-test-http` [Iter8](https://iter8.tools/) experiment generates requests for HTTP services, collects latency and error-related metrics, and validates service-level objectives (SLOs).

<p align='center'>
  <img alt-text="load-test-http" src="../images/http-overview.png" width="90%" />
</p>

***

--8<-- "./usecases.md"

***

--8<-- "./choose-app.md

***

## Launch an Iter8 Experiment
We are now ready to benchmark an HTTP service with a GET endpoint by specifying the `url`.

=== "Basic Run"

    This will launch an Iter8 experiment using the default metrics and thresholds.

    ```shell
    iter8 launch -c load-test-http --set url=http://127.0.0.1/get
    ```

=== "Custom Metrics"

    Launch an experiment with custom SLOs, e.g. with an expected error rate of 0, mean latency under 50 msec, 90th percentile latency under 100 msec, and 97.5th percentile latency under 200 msec.

    ```shell
    iter8 launch -c load-test-http \
    --set percentiles={45\,97.5} \
    --set url=http://127.0.0.1/get \
    --set SLOs.http/error-rate=0 \
    --set SLOs.http/latency-mean=50 \
    --set SLOs.http/latency-p90=100 \
    --set SLOs.http/latency-p'97\.5'=200
    ```

    ??? hint
        The `--noDownload` flag reuses the Iter8 experiment `charts` folder downloaded during the previous `iter8 launch` invocation.

??? tip "Metrics and SLOs"
    The following metrics are collected by default by this experiment:

    - `http/request-count`: total number of requests sent
    - `http/error-count`: number of error responses
    - `http/error-rate`: fraction of error responses
    - `http/latency-mean`: mean of observed latency values
    - `http/latency-stddev`: standard deviation of observed latency values
    - `http/latency-min`: min of observed latency values
    - `http/latency-max`: max of observed latency values
    - `http/latency-pX`: X^th^ percentile latency, for X in `[50.0, 75.0, 90.0, 95.0, 99.0, 99.9]`

    All latency metrics have `msec` units.

    Latency percentile values beyond the default ones can be collected and used in SLO assessments by setting the `percentiles` parameter.

***

## View experiment report

--8<-- "./expreport.md"

***

## Use Iter8 Assertions to Enforce your SLOs

--8<-- "./assert.md"


***

??? tip "Advanced Scenarios: Load profile"
    Control the characteristics of the load generated by the `load-test-http` experiment by setting the number of queries (`numQueries`), the number of queries sent per second (`qps`), and the number of parallel connections used to send queries  (`connections`).

    ```shell
    iter8 launch -c load-test-http --noDownload \
    --set url=http://127.0.0.1/get \
    --set numQueries=200 \
    --set qps=10 \
    --set connections=5
    ```


??? tip "Advanced Scenarios: Sending Custom Payloads"
    Send any type of content as payload and specify the HTTP Content Type header. These options switch the HTTP method to POST.

    === "String"
        Specify payload as a string. By default, its content type is set to `application/octet-stream`.
        ```shell
        iter8 launch -c load-test-http --noDownload \
        --set url=http://127.0.0.1/post \
        --set payloadStr="abc123"
        ```

    === "String with contentType"
        ```shell
        iter8 launch -c load-test-http --noDownload \
        --set url=http://127.0.0.1/post \
        --set payloadStr="abc123" \
        --set contentType="text/plain"
        ```

    === "JSON from URL"
        Fetch JSON content from a URL. Use this JSON as payload. Set content type to `application/json`.
        ```shell
        iter8 launch -c load-test-http --noDownload \
        --set url=http://127.0.0.1/post \
        --set payloadURL=https://data.police.uk/api/crimes-street-dates \
        --set contentType="application/json"
        ```

    === "Image from URL"
        Fetch jpeg image from a URL. Use this image as payload. Set content type to `image/jpeg`.
        ```shell
        iter8 launch -c load-test-http --noDownload \
        --set url=http://127.0.0.1/post \
        --set payloadURL=https://cdn.pixabay.com/photo/2021/09/08/17/58/poppy-6607526_1280.jpg \
        --set contentType="image/jpeg"
        ```

***

To learn more about all the parameters of the `load-test-http` chart and their default values, please refer to the [chart's `values.yaml` file](../../user-guide/topics/values.md).

## Stop the application

=== "httpbin"
    ```shell
    docker kill httpbin && docker rm httpbin
    ```
